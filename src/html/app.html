<main id="main-editor">
	<title-bar
		:note="selectedNote"
		:bookmark="selectedBookmark"
		:rack="selectedRack"
		:folder="selectedFolder"
		:toggle-full-screen="toggleFullScreen"
		:toggle-toolbar="toggleToolbar"
		:open-sync="openSync"
		:move-sync="moveSync"
		:open-about="openAbout"
		:is-full-screen="isFullScreen"
		:is-toolbar-enabled="isToolbarEnabled"
		:selected-theme="selectedTheme"
		:change-theme="changeTheme"
		:notes-display-order="notesDisplayOrder"
		:change-display-order="changeDisplayOrder">
	</title-bar>
	<div class="my-main" :class="{'note_selected': isNoteSelected }">
		<div :class="{'outer_wrapper': true}">
			<div class="sidebar">
				<div class="cell-container" ref="sidebarRacks">
					<div class="my-shelf" @contextmenu="shelfMenu()">
						<div class="my-shelf-wrapper">
							<racks
								:racks="racks"
								:selected-rack="selectedRack"
								:dragging-note="draggingNote"
								:change-rack="changeRack"
								:add-rack-separator="addRackSeparator"
								:editing-rack="editingRack"
								:editing-folder="editingFolder"
								:dragging-rack="draggingRack"
								:dragging-folder="draggingFolder"
								ref="refRacks">
							</racks>
						</div>
					</div>
				</div>
				<div class="cell-container" ref="sidebarFolders">
					<folders
						v-if="selectedRack"
						:parent-folder="selectedRack"
						:selected-folder="selectedFolder"
						:dragging-note="draggingNote"
						:change-folder="changeFolder"
						:folder-drag-ended="folderDragEnded"
						:set-dragging-note="setDraggingNote"
						:delete-folder="deleteFolder"
						:add-folder-to-rack="addFolderToRack"
						:editing-rack="editingRack"
						:editing-folder="editingFolder"
						:dragging-folder="draggingFolder"
						ref="refFolders">
					</folders>
				</div>
				<handler-stack :sidebar-drag="sidebarDrag" :sidebar-drag-end="sidebarDragEnd" ref="refHandleStack"></handler-stack>
				<div class="cell-container" ref="sidebarNotes">
					<add-note v-if="selectedFolder"
						:notes-list="isNoteRackSelected"
						:selected-folder="selectedFolder"
						:selected-rack="selectedRack">
					</add-note>
					<div class="my-shelf-notes" :class="{ 'folder-selected': selectedFolder }" ref="refNotes">
						<notes
							:bookmarks-list="!isNoteRackSelected"
							:notes="filteredNotes"
							:toggle-full-screen="toggleFullScreen"
							:original-notes="notes"
							:selected-note="selectedNote"
							:selected-rack="selectedRack"
							:selected-folder="selectedFolder"
							:dragging-note="draggingNote"
							:change-note="changeNote"
							:set-dragging-note="setDraggingNote"
							:notes-display-order="notesDisplayOrder"
							:refresh-bookmark-thumb="refreshBookmarkThumb"
							:refresh-favicon="refreshFavicon"
							:get-bookmark-meta-image="getBookmarkMetaImage"
							:edit-bookmark="editBookmark"
							:loading-uid="loadingUid">
						</notes>
					</div>
				</div>
				<handler-notes :sidebar-drag="sidebarDrag" :sidebar-drag-end="sidebarDragEnd" ref="refHandleNote"></handler-notes>
			</div>
			<div class="cell-container main-cell-container" :class="[ 'font'+fontsize ]" style="margin-left:360px;">
				<note-menu v-if="isNoteSelected || isOutlineSelected"
					:note="selectedNote"
					:is-full-screen="isFullScreen"
					:is-toolbar-enabled="isToolbarEnabled"
					:is-note-selected="isNoteSelected"
					:is-outline-selected="isOutlineSelected"
					:is-preview="isPreview"
					:fontsize="fontsize"
					:toggle-preview="togglePreview"
					:note-headings="noteHeadings"
					:send-flash-message="sendFlashMessage">
				</note-menu>
				<div class="my-editor" :class="{ 'browser-open': selectedBookmark.name }" ref="myEditor">
					<div v-if="isOutlineSelected">
						<outline
							:outline-note="selectedNote">
						</outline>
					</div>
					<div v-else-if="isNoteSelected || selectedBookmark.name">
						<codemirror v-show="!isPreview && isNoteSelected"
							:note="selectedNote"
							:is-full-screen="isFullScreen"
							:is-preview="isPreview"
							:toggle-preview="togglePreview"
							:search="search"
							ref="refCodeMirror">
						</codemirror>
						<div v-show="isPreview && isNoteSelected" class="my-editor-preview" @contextmenu.prevent.stop="previewMenu()">
							<div v-html="preview">
							</div>
						</div>
						<div class="my-internal-browser" v-show="selectedBookmark.name">
							<browser
								:bookmark="selectedBookmark"
								:bookmarks-domains="bookmarksDomains"
								:send-flash-message="sendFlashMessage"
								ref="refBrowser">
							</browser>
						</div>
					</div>
					<div v-else-if="notesHistory && notesHistory.length > 0">
						<div class="my-splash-page">
							<welcome-splash
								:keep-history="keepHistory"
								:notes="notesHistory"
								:change-note="changeNote">
							</welcome-splash>
						</div>
					</div>
				</div>
				<note-footer v-if="isNoteSelected && !isOutlineSelected"
					v-show="!isPreview && isToolbarEnabled" ref="refNoteFooter">
				</note-footer>
				<flashmessage :messages="messages"></flashmessage>
			</div>
		</div>
	</div>
	<modal ref="dialog"></modal>
	<webview id="bookmark-webview" src="about:blank" ref="webview"></webview>
</main>